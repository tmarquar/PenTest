#! /bin/bash

echo "--------------------------------------"
echo "     Website Vulnerabilities Scan     "
echo "--------------------------------------"
echo ""
echo "Enter your website address with only the domain, leaving off \"http://\" or \"https://\"."
echo "Example: (Correct: www.mysite.com) (Incorrect: http://www.mysite.com)"
echo ""

read -p "Enter site URL here: " siteUrl
echo "Site URL entered: $siteUrl"
echo ""

export siteUrl
cd /root/Desktop/source/tests
./ssl-test.sh
./wp-scanner.sh

echo "-----------------------------------------"
echo "          All tests complete.            "
echo "-----------------------------------------"

echo ""
echo "Packaging results..."
rm -f *.zip
cd /root/Desktop/source/tests/logs
current_time=$(date "+%Y.%m.%d-%H.%M.%S")
zip -q web-vuln-scan--$siteUrl--$current_time.zip *
rm -f *.log

openssl rand -base64 32 > key.bin
openssl rsautl -encrypt -inkey /root/Desktop/source/id_rsa.pub.pem -pubin -in key.bin -out key.bin.enc
openssl enc -aes-256-cbc -salt -in web-vuln-scan--$siteUrl--$current_time.zip -out web-vuln-scan--$siteUrl--$current_time.zip.enc -pass file:./key.bin
rm key.bin
rm web-vuln-scan--$siteUrl--$current_time.zip

echo ""
echo "Sending results..."

echo ""
echo "Results sent!"

echo "-----------------------------------------"
echo "      Script complete. Refer to          "
echo "     instructions for next steps.        "
echo "-----------------------------------------"

read EXIT_KEY
