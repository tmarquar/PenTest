<?php // business.php
class Business
{
    // get the connections out here
    private $conn;
    private $table_name = "businesses";
    
    // object properties
    public $business_id;
    public $name;
    public $address;
    public $city;
    public $state;
    public $zip;
    
    // constructor using db connection
    public function __construct($db)
    {
        $this->conn         = $db;
    }
    
    // read businesses
    function read()
    {
        // select all query
        $query  = "SELECT Business_ID, Name, Address, City, State, Zip
                    FROM ". $this->table_name ."
                    ORDER BY Name";
                    
        // prepare query statement
        $stmt   = $this->conn->prepare($query);
        
        // execute query
        $stmt->execute();
        
        return $stmt;
    }
    
    // pull one
    function pull_one()
    {
        $query  = "SELECT Name, Address, City, State, Zip
                    FROM ". $this->table_name ."
                    WHERE Business_ID = '". $this->business_id ."'
                    ORDER BY Name";
        // prepare the statement
        $stmt   = $this->conn->prepare($query);
        
        $stmt->execute();
        
        $row = $stmt->fetch(PDO::FETCH_ASSOC);
        // Set applicable values
        $this->name     = $row['Name'];
        $this->address  = $row['Address'];
        $this->city     = $row['City'];
        $this->state    = $row['State'];
        $this->zip      = $row['Zip'];
    }
    
    // update
    function update()
    {
        // the update query
        $query  = "UPDATE ". $this->table_name ."
                    SET
                        Name    =:name,
                        Address =:address,
                        City    =:city,
                        State   =:state,
                        Zip     =:zip
                    WHERE
                        Business_ID =:business_id";
                        
        // prepare the statement
        $stmt   = $this->conn->prepare($query);
        
        // sanitize that shiz
        $this->name         = htmlspecialchars(strip_tags($this->name));
        $this->address      = htmlspecialchars(strip_tags($this->address));
        $this->city         = htmlspecialchars(strip_tags($this->city));
        $this->state        = htmlspecialchars(strip_tags($this->state));
        $this->zip          = htmlspecialchars(strip_tags($this->zip));
        $this->business_id  = htmlspecialchars(strip_tags($this->business_id));
        
        // ... and in the darkness, bind them
        $stmt->bindParam(':name',       $this->name);
        $stmt->bindParam(':address',    $this->address);
        $stmt->bindParam(':city',       $this->city);
        $stmt->bindParam(':state',      $this->state);
        $stmt->bindParam(':zip',        $this->zip);
        $stmt->bindParam(':business_id',$this->business_id);
        
        // execute it
        if ($stmt->execute())
        (
            return true;
        )
        return false;
    }
}
?>