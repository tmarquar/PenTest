<?php // port_scan.php
class Port_Scan
{
    // da connections...
    private $conn;
    private $table_name = "port_scan";
    
    // object proberties
    public $business_id;
    public $machine_id;
    public $port_num;
    public $status;
    
    // the constructor!
    public function __construct($db)
    {
        $this->conn         = $db;
    }
    
    function read()
    {
        $this->business_id      = htmlspecialchars(strip_tags($this->business_id));
        $this->machine_id       = htmlspecialchars(strip_tags($this->machine_id));
        
        $query  = "SELECT Business_ID, Machine_ID, Port_Number, Port_Status
                    FROM ". $this->table_name ."
                    WHERE 
                        Business_ID = '". $this->business_id ."'
                            AND
                        Machine_ID = '". $this->machine_id ."'
                    ORDER BY Machine_ID";
        
        $stmt   = $this->conn->prepare($query);
        
        $stmt->execute();
        
        return $stmt;
    }
    
    // pull one set of ports
    function pull_one()
    {
        $query  = "SELECT Port_Number, Port_Status
                    FROM ". $this->table_name ."
                    WHERE
                        Business_ID = '". $this->business_id ."'
                            AND
                        Machine_ID = '". $this->machine_id ."'";
        
        $stmt   = $this->conn->prepare($query);
        
        $stmt->execute();
        
        $row    = $stmt->fetch(PDO::FETCH_ASSOC);
        
        $this->port_num = $row['Port_Number'];
        $this->status   = $row['Port_Status'];
    }
    
    function create()
    {
        $query  = "INSERT INTO ". $this->table_name ."
                    SET
                        Business_ID     =:business_id,
                        Machine_ID      =:machine_id,
                        Port_Number     =:port_num,
                        Port_Status     =:status";
        
        $stmt   = $this->conn->prepare($query);
        
        $this->business_id      = htmlspecialchars(strip_tags($this->business_id));
        $this->machine_id       = htmlspecialchars(strip_tags($this->machine_id));
        $this->port_num         = htmlspecialchars(strip_tags($this->port_num));
        $this->status           = htmlspecialchars(strip_tags($this->status));
        
        $stmt->bindParam(':business_id',    $this->business_id);
        $stmt->bindParam(':machine_id',     $this->machine_id);
        $stmt->bindParam(':port_num',       $this->port_num);
        $stmt->bindParam(':status',         $this->status);
        
        if ($stmt->execute())
        {
            return true;
        }
        return false;
    }
    
    function update()
    {
        $query  = "UPDATE ". $this->table_name ."
                    SET
                        Port_Number     =:port_num,
                        Port_Status     =:status
                    WHERE
                        Business_ID     =:business_id
                            AND
                        Machine_ID      =:machine_id";

        $stmt   = $this->conn->prepare($query);
        
        $this->business_id      = htmlspecialchars(strip_tags($this->business_id));
        $this->machine_id       = htmlspecialchars(strip_tags($this->machine_id));
        $this->port_num         = htmlspecialchars(strip_tags($this->port_num));
        $this->status           = htmlspecialchars(strip_tags($this->status));
        
        $stmt->bindParam(':business_id',    $this->business_id);
        $stmt->bindParam(':machine_id',     $this->machine_id);
        $stmt->bindParam(':port_num',       $this->port_num);
        $stmt->bindParam(':status',         $this->status);
        
        if ($stmt->execute())
        {
            return true;
        }
        return false;
    }
}
?>