<?php // usb_devices.php
class Usb_Devices
{
    private $conn;
    private $table_name = "usb_devices";
    
    public $business_id;
    public $machine_id;
    public $drive_name;
    public $free_space;
    
    public function __construct($db)
    {
        $this->conn         = $db;
    }
    
    function read()
    {
        $this->business_id      = htmlspecialchars(strip_tags($this->business_id));
        $this->machine_id       = htmlspecialchars(strip_tags($this->machine_id));
        
        $query  = "SELECT Drive_Name, Free_Space
                    FROM ". $this->table_name ."
                    WHERE
                        Business_ID = '". $this->business_id ."'
                            AND
                        Machine_ID = '".$this->machine_id ."'
                    ORDER BY Drive_Name";
        
        $stmt   = $this->conn->prepare($query);
        
        $stmt->execute();
        
        return $stmt;
    }
    
    function pull_one()
    {
        $query  = "SELECT Drive_Name, Free_Space
                    FROM ". $this->table_name ."
                    WHERE
                        Business_ID = '". $this->business_id ."'
                            AND
                        Machine_ID = '". $this->machine_id ."'
                            AND
                        Drive_Name = '". $this->drive_name ."'";
        
        $stmt   = $this->conn->prepare($query);
        
        $stmt->execute();
        
        $row    = $stmt->fetch(PDO::FETCH_ASSOC);
        
        $this->drive_name   = $row['Drive_Name'];
        $this->free_space   = $row['Free_Space'];
    }
    
    function create()
    {
        $query  = "INSERT INTO ". $this->table_name ."
                    SET
                        Business_ID     =:business_id,
                        Machine_ID      =:machine_id,
                        Drive_Name      =:drive_name,
                        Free_Space      =:free_space";
        
        $stmt   = $this->conn->prepare($query);
        
        $this->business_id      = htmlspecialchars(strip_tags($this->business_id));
        $this->machine_id       = htmlspecialchars(strip_tags($this->machine_id));
        $this->drive_name       = htmlspecialchars(strip_tags($this->drive_name));
        $this->free_space       = htmlspecialchars(strip_tags($this->free_space));
        
        $stmt->bindParam(':business_id',    $this->business_id);
        $stmt->bindParam(':machine_id',     $this->machine_id);
        $stmt->bindParam(':drive_name',     $this->drive_name);
        $stmt->bindParam(':free_space',     $this->free_space);
        
        if ($stmt->execute())
        {
            return true;
        }
        return false;
    }
    
    function update()
    {
        $query  = "UPDATE ". $this->table_name ."
                    SET
                        Drive_Name      =:drive_name,
                        Free_Space      =:free_space
                    WHERE
                        Business_ID     =:business_id
                            AND
                        Machine_ID      =:machine_id";
        
        $stmt   = $this->conn->prepare($query);
        
        // Stop trying to take business_id and machine_id out of here, ya doofus.
        // They're needed for the locating of the update.
        $this->business_id      = htmlspecialchars(strip_tags($this->business_id));
        $this->machine_id       = htmlspecialchars(strip_tags($this->machine_id));
        $this->drive_name       = htmlspecialchars(strip_tags($this->drive_name));
        
        $stmt->bindParam(':business_id',    $this->business_id);
        $stmt->bindParam(':machine_id',     $this->machine_id);
        $stmt->bindParam(':drive_space',    $this->drive_name);
        $stmt->bindParam(':free_space',     $this->free_space);
        
        if($stmt->execute())
        {
            return true;
        }
        return false;
    }
}
?>