<?php // user_documents.php
class User_Documents
{
    private $conn;
    private $table_name = "user_documents";
    
    public $business_id;
    public $machine_id;
    public $name;
    public $extension_type;
    public $path;
    public $last_access_time;
    
    public function __construct($db)
    {
        $this->conn         = $db;
    }
    
    function read()
    {
        $this->business_id      = htmlspecialchars(strip_tags($this->business_id));
        $this->machine_id       = htmlspecialchars(strip_tags($this->machine_id));
        
        $query  = "SELECT
                        Business_ID,
                        Machine_ID,
                        Name,
                        Extension_Type,
                        Path,
                        Last_Access_Time
                    FROM ". $this->table_name ."
                    WHERE
                        Business_ID = '". $this->business_id ."'
                            AND
                        Machine_ID = '". $this->machine_id ."'
                    ORDER BY Name";
                    
        $stmt   = $this->conn->prepare($query);
        
        $stmt->execute();
        
        return $stmt;
    }
    
    function pull_one()
    {
        $query  = "SELECT
                        Name,
                        Extension_Type,
                        Path,
                        Last_Access_Time
                    FROM ". $this->table_name ."
                    WHERE
                        Business_ID = '". $this->business_id ."'
                            AND
                        Machine_ID  = '". $this->machine_id ."'
                            AND
                        Name        = '". $this->name ."'
                    ORDER BY Name";
        
        $stmt   = $this->conn->prepare($query);
        
        $tmt->execute();
        
        $row    = $stmt->fetch(PDO::FETCH_ASSOC);
        
        $this->name             = $row['Name'];
        $this->extension_type   = $row['Extension_Type'];
        $this->path             = $row['Path'];
        $this->last_access_time = $row['Last_Access_Time'];
    }
    
    function create()
    {
        $query      = "INSERT INTO ". $this->table_name ."
                        SET
                            Business_ID     =:business_id,
                            Machine_ID      =:machine_id,
                            Name            =:name,
                            Extension_Type  =:extension_type,
                            Path            =:path,
                            Last_Access_Time=:last_access_time";
                            
        $stmt   = $this->conn->prepare($query);
        
        // sanitize
        $this->business_id      = htmlspecialchars(strip_tags($this->business_id));
        $this->machine_id       = htmlspecialchars(strip_tags($this->machine_id));
        $this->name             = htmlspecialchars(strip_tags($this->name));
        $this->extension_type   = htmlspecialchars(strip_tags($this->extension_type));
        $this->path             = htmlspecialchars(strip_tags($this->path));
        $this->last_access_time = htmlspecialchars(strip_tags($this->last_access_time));
        
        $stmt->bindParam(':business_id',        $this->business_id);
        $stmt->bindParam(':machine_id',         $this->machine_id);
        $stmt->bindParam(':name',               $this->name);
        $stmt->bindParam(':extension_type',     $this->extension_type);
        $stmt->bindParam(':path',               $this->path);
        $stmt->bindParam(':last_access_time',   $this->last_access_time);
        
        if ($stmt->execute())
        {
            return true;
        }
        return false;
    }
    
    function update()
    {
        $query  = "UPDATE ". $this->table_name ."
                    SET
                        Name            =:name,
                        Extension_Type  =:extension_type,
                        Path            =:path,
                        Last_Access_Time=:last_access_time
                    WHERE
                        Business_ID     =:business_id
                            AND
                        Machine_ID      =:machine_id
                            AND
                        Name            =:name";
                        
        $stmt   = $this->conn->prepare($query);
        
        // sanitize
        $this->business_id      = htmlspecialchars(strip_tags($this->business_id));
        $this->machine_id       = htmlspecialchars(strip_tags($this->machine_id));
        $this->name             = htmlspecialchars(strip_tags($this->name));
        $this->extension_type   = htmlspecialchars(strip_tags($this->extension_type));
        $this->path             = htmlspecialchars(strip_tags($this->path));
        $this->last_access_time = htmlspecialchars(strip_tags($this->last_access_time));
        
        $stmt->bindParam(':business_id',        $this->business_id);
        $stmt->bindParam(':machine_id',         $this->machine_id);
        $stmt->bindParam(':name',               $this->name);
        $stmt->bindParam(':extension_type',     $this->extension_type);
        $stmt->bindParam(':path',               $this->path);
        $stmt->bindParam(':last_access_time',   $this->last_access_time);
        
        if ($stmt->execute())
        {
            return true;
        }
        return false;
    }
}
?>