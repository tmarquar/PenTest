<?php // create.php for Computer_Info
//headers
header("Access-Control-Allow-Origin: *");
header("Content-Type: application/json; charset=UTF-8");
header("Access-Control-Allow-Methods: POST");
header("Access-Control-Allow-Headers: Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With");

// get database connection
include_once '../configuration/database.php';
include_once '../objects/computer_info.php';
include_once '../configuration/verifier.php';

$database   = new Database();
$db         = $database->get_connection();

// database connection established...
// verify token integrity
$bouncer    = new Verifier($db);
$token      = NULL;
if (isset($_GET['Token']))
{
    $token  = $_GET['Token'];
}

if  ($bouncer->verify($token))
{
    $comp_info  = new Computer_Info($db);

    // get the sent-in database
    $data = json_decode(file_get_contents("php://input"), true);

    // set computer properties
    $comp_info->business_id         = $data['business_id'];
    $comp_info->machine_id          = $data['machine_id'];
    $comp_info->os                  = $data['os'];
    $comp_info->os_sn               = $data['os_sn'];
    $comp_info->user                = $data['user'];
    $comp_info->uptime              = $data['uptime'];
    $comp_info->manufacturer        = $data['manufacturer'];
    $comp_info->model               = $data['model'];
    $comp_info->serial_number       = $data['serial_number'];
    $comp_info->firewall            = $data['firewall'];
    $comp_info->drive_size          = $data['drive_size'];
    $comp_info->drive_free_space    = $data['drive_free_space'];
    $comp_info->ram                 = $data['ram'];
    $comp_info->processor           = $data['processor'];
    $comp_info->cd_drive            = $data['cd_drive'];
    $comp_info->graphics            = $data['graphics'];
    
    if ($comp_info->create())
    {
        http_response_code(200);
    }
    else
    {
        http_response_code(400);
    }
}
// otherwise the token doesn't count, so no dice
else
{
    http_response_code(401);
}
?>