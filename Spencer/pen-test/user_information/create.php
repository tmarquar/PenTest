<? // create.php for user_information
// headers
header("Access-Control-Allow-Origin: *");
header("Content-Type: application/json; charset=UTF-8");
header("Access-Control-Allow-Methods: POST");
header("Access-Control-Allow-Headers: Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With");

// get the necessary supporting files and database connection.
include_once '../configuration/database.php';
include_once '../objects/user_information.php';
include_once '../configuration/verifier.php';

$database       = new Database();
$db             = $database->get_connection();

// now that the database is verified, let's verify the token
$bouncer        = new Verifier($db);
$token          = NULL;
if(isset($_GET['Token']))
{
    $token      = $_GET['Token'];
}

// if the token checks out...
if ($bouncer->verify($token))
{
    $user       = new User_Information($db);
    
    // unpack the incoming data
    $data       = json_decode(file_get_contents("php://input"), true);
    
    // make sure that the necessary fileds are filled in.
    if (isset($data['business_id']) and isset($data['machine_id']) and isset($data['sid']))
    {
        $user->business_id      = $data['business_id'];
        $user->machine_id       = $data['machine_id'];
        $user->name             = $data['name'];
        $user->account_type     = $data['type'];
        $user->s_id             = $data['sid'];
        $user->domain           = $data['domain'];
        $user->password_required= $data['password'];
        $user->is_admin         = $data['admin'];
        
        // attmempt the put
        if($user->create())
        {
            http_response_code(200);
        }
        else
        {
            http_response_code(400);
        }
    }
    // otherwise not all of the keys were given
    else
    {
        http_response_code(406);
    }
}
// otherwise the bouncer did it's job
else
{
    http_response_code(401);
}
?>